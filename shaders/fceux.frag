extern float paletteWidth;
varying vec2 vTexCoord;

const int PALETTE_SIZE = 54;
const vec3 nesPalette[PALETTE_SIZE] = vec3[](
    vec3(252.0/255.0, 252.0/255.0, 252.0/255.0),
    vec3(188.0/255.0, 188.0/255.0, 188.0/255.0),
    vec3(116.0/255.0, 116.0/255.0, 116.0/255.0),
    vec3(0.0, 0.0, 0.0),
    vec3(168.0/255.0, 228.0/255.0, 252.0/255.0),
    vec3(60.0/255.0, 188.0/255.0, 252.0/255.0),
    vec3(0.0, 112.0/255.0, 236.0/255.0),
    vec3(36.0/255.0, 24.0/255.0, 140.0/255.0),
    vec3(196.0/255.0, 212.0/255.0, 252.0/255.0),
    vec3(92.0/255.0, 148.0/255.0, 252.0/255.0),
    vec3(32.0/255.0, 56.0/255.0, 236.0/255.0),
    vec3(0.0, 0.0, 168.0/255.0),
    vec3(212.0/255.0, 200.0/255.0, 252.0/255.0),
    vec3(204.0/255.0, 136.0/255.0, 252.0/255.0),
    vec3(128.0/255.0, 0.0, 240.0/255.0),
    vec3(68.0/255.0, 0.0, 156.0/255.0),
    vec3(252.0/255.0, 196.0/255.0, 252.0/255.0),
    vec3(244.0/255.0, 120.0/255.0, 252.0/255.0),
    vec3(188.0/255.0, 0.0, 188.0/255.0),
    vec3(140.0/255.0, 0.0, 116.0/255.0),
    vec3(252.0/255.0, 196.0/255.0, 216.0/255.0),
    vec3(252.0/255.0, 116.0/255.0, 180.0/255.0),
    vec3(228.0/255.0, 0.0, 88.0/255.0),
    vec3(168.0/255.0, 0.0, 16.0/255.0),
    vec3(252.0/255.0, 188.0/255.0, 176.0/255.0),
    vec3(252.0/255.0, 116.0/255.0, 96.0/255.0),
    vec3(216.0/255.0, 40.0/255.0, 0.0),
    vec3(164.0/255.0, 0.0, 0.0),
    vec3(252.0/255.0, 216.0/255.0, 168.0/255.0),
    vec3(252.0/255.0, 152.0/255.0, 56.0/255.0),
    vec3(200.0/255.0, 76.0/255.0, 12.0/255.0),
    vec3(124.0/255.0, 8.0/255.0, 0.0),
    vec3(252.0/255.0, 228.0/255.0, 160.0/255.0),
    vec3(240.0/255.0, 188.0/255.0, 60.0/255.0),
    vec3(136.0/255.0, 112.0/255.0, 0.0),
    vec3(64.0/255.0, 44.0/255.0, 0.0),
    vec3(224.0/255.0, 252.0/255.0, 160.0/255.0),
    vec3(128.0/255.0, 208.0/255.0, 16.0/255.0),
    vec3(0.0, 148.0/255.0, 0.0),
    vec3(0.0, 68.0/255.0, 0.0),
    vec3(168.0/255.0, 240.0/255.0, 188.0/255.0),
    vec3(76.0/255.0, 220.0/255.0, 72.0/255.0),
    vec3(0.0, 168.0/255.0, 0.0),
    vec3(0.0, 80.0/255.0, 0.0),
    vec3(176.0/255.0, 252.0/255.0, 204.0/255.0),
    vec3(88.0/255.0, 248.0/255.0, 152.0/255.0),
    vec3(0.0, 144.0/255.0, 56.0/255.0),
    vec3(0.0, 60.0/255.0, 20.0/255.0),
    vec3(156.0/255.0, 252.0/255.0, 240.0/255.0),
    vec3(1.0/255.0, 232.0/255.0, 216.0/255.0),
    vec3(0.0, 128.0/255.0, 136.0/255.0),
    vec3(24.0/255.0, 60.0/255.0, 92.0/255.0),
    vec3(196.0/255.0, 196.0/255.0, 196.0/255.0),
    vec3(120.0/255.0, 120.0/255.0, 120.0/255.0)
);

void main()
{
    vec4 col4 = texture2D(love_Texture, vTexCoord);
    vec3 color = col4.rgb;
    float bestDist = 1e9;
    vec3 bestColor = vec3(0.0);
    for(int i = 0; i < PALETTE_SIZE; i++){
        vec3 d = color - nesPalette[i];
        float dist = dot(d,d);
        if(dist < bestDist){
            bestDist = dist;
            bestColor = nesPalette[i];
        }
    }
    gl_FragColor = vec4(bestColor, col4.a);
}
